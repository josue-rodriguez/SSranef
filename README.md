
<!-- README.md is generated from README.Rmd. Please edit that file -->

# SSranef

<!-- badges: start -->
<!-- badges: end -->

SSranef is an R package for random effects selection that corresponds to
the models described in Rodriguez, Williams, and Rast (2021).
Specifically, `ss_ranef_alpha()` fits a random intercepts model with a
spike-and-slab prior on the random effects, and `ss_ranef_beta()` fits a
model with both random intercepts and random slopes, with a
spike-and-slab prior on the random effects for the slope.

## Installation

This package can be installed with

``` r
# install.packages("devtools")
devtools::install_github("josue-rodriguez/SSranef")
```

## Example

Because `SSranef` uses JAGS as a backend, we must also load the `rjags`
package.

``` r
library(SSranef)
#> Warning: replacing previous import 'Matrix::update' by 'stats::update' when
#> loading 'SSranef'
library(rjags)
#> Loading required package: coda
#> Linked to JAGS 4.3.0
#> Loaded modules: basemod,bugs

d <- lme4::sleepstudy
```

## Alpha model

``` r
d$y <- c(scale(d$Reaction))

alpha <- ss_ranef_alpha(y = d$y, unit = d$Subject)
#> Compiling model graph
#>    Resolving undeclared variables
#>    Allocating nodes
#> Graph information:
#>    Observed stochastic nodes: 180
#>    Unobserved stochastic nodes: 39
#>    Total graph size: 486
#> 
#> Initializing model

posterior_summary(alpha, ci = 0.90, digits = 2)
#>       Post.mean   q05  q95
#> alpha      0.08 -0.09 0.25
#> sigma      0.79  0.72 0.86
#> tau        0.98  0.63 1.49
```

``` r
ranef_summary(alpha, ci = 0.95, digits = 2)
#>           Post.mean  q025  q975  PIP   BF_10 BF_01
#> theta_308      0.56  0.00  1.15 0.87    6.63  0.15
#> theta_309     -1.44 -1.97 -0.90 1.00     Inf  0.00
#> theta_310     -1.19 -1.72 -0.65 1.00 3999.00  0.00
#> theta_330      0.00 -0.32  0.29 0.20    0.26  3.89
#> theta_331      0.03 -0.20  0.46 0.24    0.32  3.08
#> theta_332      0.02 -0.21  0.39 0.23    0.29  3.42
#> theta_333      0.07 -0.12  0.60 0.29    0.41  2.42
#> theta_334     -0.03 -0.49  0.19 0.24    0.31  3.25
#> theta_335     -0.87 -1.40 -0.33 0.99  107.11  0.01
#> theta_337      1.20  0.69  1.71 1.00     Inf  0.00
#> theta_349     -0.28 -0.92  0.00 0.58    1.41  0.71
#> theta_350      0.05 -0.15  0.54 0.29    0.40  2.48
#> theta_351     -0.07 -0.59  0.11 0.28    0.38  2.60
#> theta_352      0.44  0.00  1.08 0.77    3.38  0.30
#> theta_369      0.01 -0.25  0.39 0.21    0.27  3.71
#> theta_370     -0.05 -0.53  0.16 0.28    0.39  2.56
#> theta_371     -0.03 -0.46  0.18 0.24    0.32  3.16
#> theta_372      0.08 -0.12  0.64 0.32    0.47  2.11
```

``` r
caterpillar_plot(alpha)
```

<img src="man/figures/README-unnamed-chunk-4-1.png" width="100%" />

``` r
pip_plot(alpha)
```

<img src="man/figures/README-unnamed-chunk-5-1.png" width="100%" />

## Beta model

``` r
beta <- ss_ranef_beta(y = d$y, X = d$Days, unit = d$Subject)
#> Compiling model graph
#>    Resolving undeclared variables
#>    Allocating nodes
#> Graph information:
#>    Observed stochastic nodes: 180
#>    Unobserved stochastic nodes: 60
#>    Total graph size: 1316
#> 
#> Initializing model
posterior_summary(beta, digits = 2)
#>       Post.mean   q05   q95
#> alpha     -0.84 -1.02 -0.65
#> beta       0.19  0.16  0.22
#> sigma      0.47  0.43  0.52
#> tau1       0.42  0.24  0.62
#> tau2       0.16  0.10  0.26
#> rho        0.22 -0.31  0.76
```

``` r
ranef_summary(beta, digits = 2)
#>            Post.mean   q05   q95  PIP  BF_10 BF_01
#> theta1_308      0.04 -0.37  0.42   NA     NA    NA
#> theta1_309     -0.61 -1.04 -0.22   NA     NA    NA
#> theta1_310     -0.65 -1.14 -0.23   NA     NA    NA
#> theta1_330      0.28 -0.10  0.74   NA     NA    NA
#> theta1_331      0.24 -0.09  0.63   NA     NA    NA
#> theta1_332      0.13 -0.19  0.46   NA     NA    NA
#> theta1_333      0.27 -0.04  0.58   NA     NA    NA
#> theta1_334     -0.07 -0.40  0.23   NA     NA    NA
#> theta1_335      0.00 -0.39  0.43   NA     NA    NA
#> theta1_337      0.53  0.15  0.93   NA     NA    NA
#> theta1_349     -0.37 -0.71 -0.06   NA     NA    NA
#> theta1_350     -0.19 -0.63  0.24   NA     NA    NA
#> theta1_351     -0.04 -0.37  0.33   NA     NA    NA
#> theta1_352      0.42  0.02  0.83   NA     NA    NA
#> theta1_369      0.09 -0.22  0.40   NA     NA    NA
#> theta1_370     -0.31 -0.78  0.08   NA     NA    NA
#> theta1_371     -0.03 -0.34  0.29   NA     NA    NA
#> theta1_372      0.26 -0.09  0.58   NA     NA    NA
#> theta2_308      0.17  0.09  0.25 1.00 306.69  0.00
#> theta2_309     -0.18 -0.26 -0.10 1.00 234.29  0.00
#> theta2_310     -0.10 -0.19  0.00 0.85   5.59  0.18
#> theta2_330     -0.06 -0.15  0.00 0.64   1.77  0.56
#> theta2_331     -0.02 -0.11  0.00 0.37   0.58  1.74
#> theta2_332      0.00 -0.04  0.03 0.23   0.30  3.32
#> theta2_333      0.00 -0.04  0.03 0.22   0.28  3.56
#> theta2_334      0.00 -0.02  0.05 0.24   0.32  3.13
#> theta2_335     -0.20 -0.28 -0.12 1.00 799.00  0.00
#> theta2_337      0.17  0.09  0.25 0.99  89.91  0.01
#> theta2_349      0.00 -0.03  0.05 0.24   0.32  3.12
#> theta2_350      0.11  0.00  0.20 0.91  10.05  0.10
#> theta2_351     -0.03 -0.11  0.00 0.44   0.80  1.25
#> theta2_352      0.05  0.00  0.14 0.57   1.32  0.76
#> theta2_369      0.00 -0.02  0.06 0.25   0.33  3.07
#> theta2_370      0.05  0.00  0.15 0.60   1.52  0.66
#> theta2_371     -0.01 -0.06  0.01 0.26   0.35  2.84
#> theta2_372      0.01 -0.01  0.07 0.28   0.38  2.63
```

``` r
caterpillar_plot(beta)
```

<img src="man/figures/README-unnamed-chunk-8-1.png" width="100%" />

``` r
pip_plot(beta)
```

<img src="man/figures/README-unnamed-chunk-9-1.png" width="100%" />

## Multivariate model

Note, this currently only returns an MCMC list for the posterior samples

``` r
mv_data <- gen_mv_data(10, 10)
str(mv_data)
#> 'data.frame':    100 obs. of  4 variables:
#>  $ y1: num  -4.365 0.303 -3.837 -4.431 0.223 ...
#>  $ y2: num  1.481 1.567 0.271 1.835 0.382 ...
#>  $ x : num  0 0 1 0 1 0 0 1 0 0 ...
#>  $ id: Factor w/ 10 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...

mv_model <- ss_ranef_mv(Y = cbind(mv_data$y1, mv_data$y2),
                 X = mv_data$x,
                 unit = mv_data$id,
                 burnin = 100,
                 iter = 500,
                 chains = 4)
#> Compiling model graph
#>    Resolving undeclared variables
#>    Allocating nodes
#> Graph information:
#>    Observed stochastic nodes: 100
#>    Unobserved stochastic nodes: 38
#>    Total graph size: 863
#> 
#> Initializing model

summary(mv_model$posterior_samples)
#> 
#> Iterations = 1101:1600
#> Thinning interval = 1 
#> Number of chains = 4 
#> Sample size per chain = 500 
#> 
#> 1. Empirical mean and standard deviation for each variable,
#>    plus standard error of the mean:
#> 
#>                  Mean       SD Naive SE Time-series SE
#> B[1,1]       1.072247  0.42839 0.009579       0.016681
#> B[2,1]       2.941657  0.16162 0.003614       0.006638
#> B[1,2]       2.306857  0.76980 0.017213       0.043967
#> B[2,2]       3.343657  0.62220 0.013913       0.082764
#> Tau[1,1]     8.578304 17.90318 0.400327       2.713288
#> Tau[2,1]     0.430411 12.02313 0.268845       2.683859
#> Tau[3,1]     0.076140  9.88296 0.220990       1.555903
#> Tau[4,1]     0.842312 11.53725 0.257981       2.793302
#> Tau[1,2]     0.430411 12.02313 0.268845       2.683859
#> Tau[2,2]    13.286229 10.06115 0.224974       0.566497
#> Tau[3,2]    -6.232521  9.22588 0.206297       0.901016
#> Tau[4,2]    12.253620  7.95408 0.177859       0.316022
#> Tau[1,3]     0.076140  9.88296 0.220990       1.555903
#> Tau[2,3]    -6.232521  9.22588 0.206297       0.901016
#> Tau[3,3]     7.843682 14.11611 0.315646       1.633942
#> Tau[4,3]    -7.098416 10.26498 0.229532       1.147613
#> Tau[1,4]     0.842312 11.53725 0.257981       2.793302
#> Tau[2,4]    12.253620  7.95408 0.177859       0.316022
#> Tau[3,4]    -7.098416 10.26498 0.229532       1.147613
#> Tau[4,4]    14.427265  9.14114 0.204402       0.506354
#> gamma1[1]    0.973500  0.16066 0.003592       0.005713
#> gamma1[2]    0.905000  0.29329 0.006558       0.009271
#> gamma1[3]    0.311000  0.46302 0.010353       0.012975
#> gamma1[4]    0.949500  0.21903 0.004898       0.011945
#> gamma1[5]    0.940000  0.23755 0.005312       0.007441
#> gamma1[6]    0.311500  0.46322 0.010358       0.012919
#> gamma1[7]    0.203000  0.40233 0.008996       0.023022
#> gamma1[8]    0.712500  0.45271 0.010123       0.015834
#> gamma1[9]    0.246000  0.43079 0.009633       0.023098
#> gamma1[10]   0.316000  0.46503 0.010398       0.020312
#> gamma2[1]    1.000000  0.00000 0.000000       0.000000
#> gamma2[2]    0.910000  0.28625 0.006401       0.053805
#> gamma2[3]    0.266500  0.44224 0.009889       0.038340
#> gamma2[4]    0.113500  0.31728 0.007095       0.065661
#> gamma2[5]    0.544000  0.49818 0.011140       0.033986
#> gamma2[6]    0.562000  0.49627 0.011097       0.031636
#> gamma2[7]    1.000000  0.00000 0.000000       0.000000
#> gamma2[8]    0.232000  0.42221 0.009441       0.043431
#> gamma2[9]    1.000000  0.00000 0.000000       0.000000
#> gamma2[10]   0.815500  0.38799 0.008676       0.041289
#> rb[1,1]      1.000000  0.00000 0.000000       0.000000
#> rb[2,1]     -0.036864  0.79868 0.017859       0.190001
#> rb[3,1]      0.153920  0.73139 0.016354       0.112959
#> rb[4,1]     -0.009027  0.80186 0.017930       0.175391
#> rb[1,2]     -0.036864  0.79868 0.017859       0.190001
#> rb[2,2]      1.000000  0.00000 0.000000       0.000000
#> rb[3,2]     -0.587777  0.59609 0.013329       0.067946
#> rb[4,2]      0.915133  0.15907 0.003557       0.011321
#> rb[1,3]      0.153920  0.73139 0.016354       0.112959
#> rb[2,3]     -0.587777  0.59609 0.013329       0.067946
#> rb[3,3]      1.000000  0.00000 0.000000       0.000000
#> rb[4,3]     -0.602037  0.60995 0.013639       0.076164
#> rb[1,4]     -0.009027  0.80186 0.017930       0.175391
#> rb[2,4]      0.915133  0.15907 0.003557       0.011321
#> rb[3,4]     -0.602037  0.60995 0.013639       0.076164
#> rb[4,4]      1.000000  0.00000 0.000000       0.000000
#> rw           0.008874  0.10414 0.002329       0.003437
#> sigma[1]     3.021093  0.23782 0.005318       0.009210
#> sigma[2]     1.099653  0.08393 0.001877       0.002533
#> theta[1,1]  -0.302412  4.66750 0.104369       1.371600
#> theta[2,1]   0.140186  2.15674 0.048226       0.359207
#> theta[3,1]  -0.139965  2.49039 0.055687       0.082835
#> theta[4,1]  -0.070448  2.88803 0.064578       0.472380
#> theta[5,1]   0.037963  3.04004 0.067977       0.601884
#> theta[6,1]  -0.099066  2.01556 0.045069       0.098260
#> theta[7,1]   0.207054  3.95619 0.088463       1.092352
#> theta[8,1]  -0.080517  2.60299 0.058205       0.338424
#> theta[9,1]   0.116670  2.68549 0.060049       0.663110
#> theta[10,1]  0.080739  1.70124 0.038041       0.127997
#> theta[1,2]  -5.433274  1.73738 0.038849       0.150266
#> theta[2,2]   2.462901  1.25137 0.027981       0.051306
#> theta[3,2]  -0.150399  2.81086 0.062853       0.066300
#> theta[4,2]  -3.282911  1.62026 0.036230       0.070558
#> theta[5,2]   3.386040  1.88576 0.042167       0.077942
#> theta[6,2]  -0.453523  2.60600 0.058272       0.078530
#> theta[7,2]   4.527647  2.22172 0.049679       0.174210
#> theta[8,2]  -1.923925  2.55759 0.057190       0.102660
#> theta[9,2]   2.959120  1.77875 0.039774       0.134520
#> theta[10,2]  0.669945  1.89300 0.042329       0.104087
#> theta[1,3]   2.865901  3.04058 0.067989       0.541594
#> theta[2,3]  -1.160342  1.55873 0.034854       0.228806
#> theta[3,3]   0.096522  2.27346 0.050836       0.054372
#> theta[4,3]   1.534274  2.44861 0.054753       0.250680
#> theta[5,3]  -1.621075  2.57280 0.057530       0.292596
#> theta[6,3]   0.238417  2.26410 0.050627       0.053322
#> theta[7,3]  -2.544863  2.84466 0.063609       0.485132
#> theta[8,3]   0.910749  2.36733 0.052935       0.105419
#> theta[9,3]  -1.698949  2.00445 0.044821       0.289478
#> theta[10,3] -0.511070  1.37724 0.030796       0.128821
#> theta[1,4]  -6.028742  0.82591 0.018468       0.074204
#> theta[2,4]   2.211131  1.19677 0.026761       0.059531
#> theta[3,4]  -0.270082  2.95846 0.066153       0.083976
#> theta[4,4]  -3.115535  2.46785 0.055183       0.110786
#> theta[5,4]   3.079074  2.62205 0.058631       0.143315
#> theta[6,4]  -0.661871  2.56744 0.057410       0.092105
#> theta[7,4]   5.181215  0.71390 0.015963       0.093851
#> theta[8,4]  -1.780569  2.89251 0.064678       0.095348
#> theta[9,4]   3.460561  0.72326 0.016173       0.094955
#> theta[10,4]  1.050856  1.65015 0.036898       0.104963
#> 
#> 2. Quantiles for each variable:
#> 
#>                  2.5%       25%       50%      75%    97.5%
#> B[1,1]        0.26866   0.77764  1.063688  1.34669  1.94425
#> B[2,1]        2.63252   2.82936  2.940612  3.05132  3.25679
#> B[1,2]        0.73486   1.79619  2.335720  2.82669  3.78720
#> B[2,2]        2.43492   2.94991  3.245361  3.56398  5.11672
#> Tau[1,1]      0.18907   0.74521  2.305096  7.74381 56.46536
#> Tau[2,1]    -21.80495  -3.94074 -0.243925  3.55449 30.78254
#> Tau[3,1]    -26.06192  -1.14689  0.266079  3.02221 17.40597
#> Tau[4,1]    -20.20704  -4.45862 -0.016844  4.09532 29.96356
#> Tau[1,2]    -21.80495  -3.94074 -0.243925  3.55449 30.78254
#> Tau[2,2]      2.79018   6.54878 10.632231 16.78415 38.11169
#> Tau[3,2]    -28.19722  -8.85022 -4.351768 -1.26310  4.81100
#> Tau[4,2]      2.94557   7.21697 10.410462 15.46066 32.53619
#> Tau[1,3]    -26.06192  -1.14689  0.266079  3.02221 17.40597
#> Tau[2,3]    -28.19722  -8.85022 -4.351768 -1.26310  4.81100
#> Tau[3,3]      0.21976   1.06124  2.853407  8.42742 44.27980
#> Tau[4,3]    -31.29138 -10.12195 -4.945300 -1.42778  5.18457
#> Tau[1,4]    -20.20704  -4.45862 -0.016844  4.09532 29.96356
#> Tau[2,4]      2.94557   7.21697 10.410462 15.46066 32.53619
#> Tau[3,4]    -31.29138 -10.12195 -4.945300 -1.42778  5.18457
#> Tau[4,4]      4.86200   8.64052 11.971357 17.63058 37.11708
#> gamma1[1]     0.00000   1.00000  1.000000  1.00000  1.00000
#> gamma1[2]     0.00000   1.00000  1.000000  1.00000  1.00000
#> gamma1[3]     0.00000   0.00000  0.000000  1.00000  1.00000
#> gamma1[4]     0.00000   1.00000  1.000000  1.00000  1.00000
#> gamma1[5]     0.00000   1.00000  1.000000  1.00000  1.00000
#> gamma1[6]     0.00000   0.00000  0.000000  1.00000  1.00000
#> gamma1[7]     0.00000   0.00000  0.000000  0.00000  1.00000
#> gamma1[8]     0.00000   0.00000  1.000000  1.00000  1.00000
#> gamma1[9]     0.00000   0.00000  0.000000  0.00000  1.00000
#> gamma1[10]    0.00000   0.00000  0.000000  1.00000  1.00000
#> gamma2[1]     1.00000   1.00000  1.000000  1.00000  1.00000
#> gamma2[2]     0.00000   1.00000  1.000000  1.00000  1.00000
#> gamma2[3]     0.00000   0.00000  0.000000  1.00000  1.00000
#> gamma2[4]     0.00000   0.00000  0.000000  0.00000  1.00000
#> gamma2[5]     0.00000   0.00000  1.000000  1.00000  1.00000
#> gamma2[6]     0.00000   0.00000  1.000000  1.00000  1.00000
#> gamma2[7]     1.00000   1.00000  1.000000  1.00000  1.00000
#> gamma2[8]     0.00000   0.00000  0.000000  0.00000  1.00000
#> gamma2[9]     1.00000   1.00000  1.000000  1.00000  1.00000
#> gamma2[10]    0.00000   1.00000  1.000000  1.00000  1.00000
#> rb[1,1]       1.00000   1.00000  1.000000  1.00000  1.00000
#> rb[2,1]      -0.99140  -0.89387 -0.126655  0.85044  0.98864
#> rb[3,1]      -0.98175  -0.61105  0.371655  0.87049  0.98866
#> rb[4,1]      -0.98785  -0.88765 -0.010367  0.86509  0.98863
#> rb[1,2]      -0.99140  -0.89387 -0.126655  0.85044  0.98864
#> rb[2,2]       1.00000   1.00000  1.000000  1.00000  1.00000
#> rb[3,2]      -0.99251  -0.96460 -0.899495 -0.50675  0.89178
#> rb[4,2]       0.52321   0.91656  0.962327  0.98023  0.99441
#> rb[1,3]      -0.98175  -0.61105  0.371655  0.87049  0.98866
#> rb[2,3]      -0.99251  -0.96460 -0.899495 -0.50675  0.89178
#> rb[3,3]       1.00000   1.00000  1.000000  1.00000  1.00000
#> rb[4,3]      -0.99278  -0.96895 -0.923984 -0.56965  0.91073
#> rb[1,4]      -0.98785  -0.88765 -0.010367  0.86509  0.98863
#> rb[2,4]       0.52321   0.91656  0.962327  0.98023  0.99441
#> rb[3,4]      -0.99278  -0.96895 -0.923984 -0.56965  0.91073
#> rb[4,4]       1.00000   1.00000  1.000000  1.00000  1.00000
#> rw           -0.18924  -0.06123  0.003832  0.08080  0.21591
#> sigma[1]      2.60831   2.85517  3.004793  3.17950  3.52805
#> sigma[2]      0.95049   1.04213  1.094898  1.15139  1.29004
#> theta[1,1]  -12.43346  -2.11626  0.048593  2.22930  8.25356
#> theta[2,1]   -3.41626  -1.08690 -0.070768  0.91778  6.10886
#> theta[3,1]   -4.97704  -0.80134 -0.083879  0.65912  4.85144
#> theta[4,1]   -7.27035  -1.24146  0.054116  1.40869  5.12614
#> theta[5,1]   -5.75911  -1.33171 -0.108281  1.02347  7.72135
#> theta[6,1]   -4.68516  -0.75283 -0.040324  0.68028  3.56939
#> theta[7,1]   -6.68905  -2.04013  0.040221  1.74805 10.87582
#> theta[8,1]   -5.57860  -0.92559  0.033997  0.97836  4.80091
#> theta[9,1]   -4.73275  -1.36315 -0.044994  1.24313  7.40669
#> theta[10,1]  -3.10886  -0.68477 -0.029818  0.73528  4.12544
#> theta[1,2]   -8.84110  -6.55473 -5.450991 -4.28213 -2.16578
#> theta[2,2]    0.21645   1.72263  2.445289  3.21248  4.89798
#> theta[3,2]   -5.53092  -1.55800 -0.308173  1.14349  6.02422
#> theta[4,2]   -6.08989  -4.26468 -3.360927 -2.37532  0.05324
#> theta[5,2]    0.26002   2.17654  3.296113  4.54552  7.28017
#> theta[6,2]   -5.60090  -1.68145 -0.540457  0.71951  5.52579
#> theta[7,2]    0.78644   2.91940  4.423168  6.04636  8.78992
#> theta[8,2]   -6.24953  -3.52408 -2.105707 -0.70986  4.12283
#> theta[9,2]   -0.13013   1.76652  2.809115  4.06573  6.54229
#> theta[10,2]  -3.43530  -0.35204  0.775105  1.83577  3.97479
#> theta[1,3]   -2.25055   0.77309  2.638115  4.70735  9.52508
#> theta[2,3]   -4.81495  -1.99633 -0.985004 -0.15501  1.40704
#> theta[3,3]   -4.37371  -0.70249  0.031146  0.80176  5.22804
#> theta[4,3]   -2.20496   0.13721  1.263282  2.66412  7.10469
#> theta[5,3]   -7.88883  -2.57103 -1.156594 -0.17148  2.04539
#> theta[6,3]   -4.20580  -0.45571  0.277519  0.98814  4.41247
#> theta[7,3]   -9.30714  -4.08309 -2.208296 -0.51576  1.98555
#> theta[8,3]   -3.10277  -0.20355  0.654916  1.82090  6.20651
#> theta[9,3]   -6.32122  -2.74005 -1.402181 -0.37323  1.41707
#> theta[10,3]  -3.47871  -1.16830 -0.383290  0.24920  1.86279
#> theta[1,4]   -7.80322  -6.52549 -5.972384 -5.45841 -4.60638
#> theta[2,4]    0.65406   1.75981  2.189062  2.65167  4.33788
#> theta[3,4]   -6.40406  -1.75406 -0.432959  1.16014  6.02596
#> theta[4,4]   -7.83394  -4.45940 -3.128663 -1.85798  1.61173
#> theta[5,4]   -0.08935   1.59245  2.296195  4.21504  9.68683
#> theta[6,4]   -5.43524  -1.77378 -1.010781  0.01702  5.38868
#> theta[7,4]    3.30554   4.85644  5.263229  5.65382  6.34726
#> theta[8,4]   -7.25586  -3.39169 -1.837676 -0.43260  5.03783
#> theta[9,4]    1.62993   3.08403  3.539141  3.95317  4.63275
#> theta[10,4]  -3.37407   0.80503  1.398756  1.88702  2.88056
```

## Priors

Priors can be passed on to either of the `ss_ranef` functions through a
named list and using JAGS code, e.g.,

``` r
# change prior for mean intercept
priors <- list(alpha = "alpha ~ dt(0, 1, 3)",
               # for each jth unit, change prior probability of inclusion
               gamma = "gamma[j] ~ dbern(0.75)") 

fit <- ss_ranef_alpha(y = d$y, unit = d$Subject, priors = priors)
#> Compiling model graph
#>    Resolving undeclared variables
#>    Allocating nodes
#> Graph information:
#>    Observed stochastic nodes: 180
#>    Unobserved stochastic nodes: 39
#>    Total graph size: 485
#> 
#> Initializing model
ranef_summary(fit)
#>           Post.mean   q05   q95  PIP  BF_10 BF_01
#> theta_308      0.61  0.00  1.07 0.95  17.87  0.06
#> theta_309     -1.40 -1.86 -0.94 1.00    Inf  0.00
#> theta_310     -1.14 -1.59 -0.69 1.00    Inf  0.00
#> theta_330      0.01 -0.33  0.37 0.52   1.07  0.94
#> theta_331      0.07 -0.21  0.47 0.53   1.14  0.87
#> theta_332      0.05 -0.26  0.45 0.52   1.06  0.94
#> theta_333      0.14 -0.14  0.62 0.59   1.43  0.70
#> theta_334     -0.06 -0.48  0.23 0.52   1.10  0.91
#> theta_335     -0.83 -1.28 -0.38 0.99 107.11  0.01
#> theta_337      1.18  0.73  1.61 1.00    Inf  0.00
#> theta_349     -0.35 -0.85  0.00 0.80   4.06  0.25
#> theta_350      0.12 -0.14  0.56 0.59   1.45  0.69
#> theta_351     -0.12 -0.56  0.13 0.56   1.27  0.79
#> theta_352      0.53  0.00  1.00 0.92  11.16  0.09
#> theta_369      0.04 -0.27  0.41 0.53   1.13  0.88
#> theta_370     -0.10 -0.53  0.17 0.55   1.22  0.82
#> theta_371     -0.07 -0.48  0.22 0.54   1.15  0.87
#> theta_372      0.17 -0.10  0.64 0.62   1.62  0.62
```

## Building on top of SSranef models

The code for each model can also be extracted to make more extensive
modifications or build more complex models

``` r
jags_model_text <- fit$model_text
cat(jags_model_text)
#> model{
#>   for (i in 1:N) {
#>     # likelihood
#>     y[i] ~ dnorm(alpha_j[unit[i]], precision)
#>   }
#>   for (j in 1:J) {
#>     gamma[j] ~ dbern(0.75)
#>     # non-centered parameterization
#>     alpha_raw[j] ~ dnorm(0, 1)
#>     theta[j] <- tau * alpha_raw[j] * gamma[j]
#>     alpha_j[j] <- alpha + theta[j]
#>     lambda[j] <- (tau^2 / (tau^2 + sigma^2/n_j[j])) * gamma[j]
#>   }
#>   alpha ~ dt(0, 1, 3)
#>   tau ~ dt(0, 1, 3)T(0, )
#>   precision <- pow(sigma, -2)
#>   sigma ~ dt(0, 1, 3)T(0, )
#> }
```
